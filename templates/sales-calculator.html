<div class="row">
    <div class="span5">
        <div class="form-horizontal">
            <legend>Price Estimator</legend>
            <div class="control-group">
                <label class="control-label">SKU</label>
                <div class="controls">
                    <select name="sku" id="sku" onchange="resetDefaults();">
                        <option value="Agency Pro">Agency Pro</option>                        
                        <option value="Agency Complete">Agency Complete</option>                        
                        <option value="Express">Express</option>
                        <option value="Team">Team</option>
                        <option value="Premium">Premium</option>
                    </select>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label">Visitors</label>
                <div class="controls">
                    <input type="text" name="pageviews" id="pageviews" value="25000" onblur="calculate();" />
                </div>
            </div>
            <div class="control-group">
                <label class="control-label">Keywords</label>
                <div class="controls">
                    <input type="text" name="keywords" id="keywords" value="50" onblur="calculate();" />
                </div>
            </div>
            <div class="control-group">
                <label class="control-label">Emails</label>
                <div class="controls">
                    <input type="text" name="emails" id="emails" value="2500" onblur="calculate();" />
                </div>
            </div>
            <div class="control-group">
                <label class="control-label">Visitor discount</label>
                <div class="controls">
                    <div id="vi-discount"></div>
                    <div id="vi-discount-val" style="padding-right: 100px; text-align: right;">0%</div>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label">Keyword discount</label>
                <div class="controls">
                    <div id="kw-discount"></div>
                    <div id="kw-discount-val" style="padding-right: 100px; text-align: right;">0%</div>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label">Email discount</label>
                <div class="controls">
                    <div id="em-discount"></div>
                    <div id="em-discount-val" style="padding-right: 100px; text-align: right;">0%</div>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label">SKU Discount</label>
                <div class="controls">
                    <div id="discount"></div>
                    <div id="discount-val" style="padding-right: 100px; text-align: right;">0%</div>
                </div>
            </div>
            <div class="control-group">
                <div class="controls">
                <!-- <button type="reset" class="btn" onclick="resetDefaults();">Reset Form</button> -->
                </div>
            </div>
        </div> <!-- form -->
    </div>
    <div class="span1">&nbsp;</div>
    <div class="span6">
    <legend>Summary</legend>
    <table class="table" style="color: #aaaaaa;">
        <thead style="color: #dddddd;">
            <tr>
                <th>Item</th>
                <th style="text-align: right;">$ COGS</th>
                <th style="text-align: right;">$ Retail</th>
                <th style="text-align: right;">$ MRR</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Baseline SKU</td>
                <td style="text-align: right;" id="baseline-cost"></td>
                <td style="text-align: right;" id="baseline-retail"></td>
                <td style="text-align: right;" id="baseline-charge"></td>
            </tr>
            <tr>
                <td>Extra page views</td>
                <td style="text-align: right;" id="pageviews-cost"></td>
                <td style="text-align: right;" id="pageviews-retail"></td>
                <td style="text-align: right;" id="pageviews-charge"></td>
            </tr>
            <tr>
                <td>Extra keywords</td>
                <td style="text-align: right;" id="keywords-cost"></td>
                <td style="text-align: right;" id="keywords-retail"></td>
                <td style="text-align: right;" id="keywords-charge"></td>
            </tr>
            <tr>
                <td>Extra email</td>
                <td style="text-align: right;" id="email-cost"></td>
                <td style="text-align: right;" id="email-retail"></td>
                <td style="text-align: right;" id="email-charge"></td>
            </tr>
        </tbody>
        <tfoot>
            <tr style="font-weight: bold; border-bottom: 4px double #666666; color: #dddddd;">
                <td>Total</td>
                <td style="text-align: right;" id="total-cost"></td>
                <td style="text-align: right;" id="total-retail"></td>
                <td style="text-align: right;" id="total-charge"></td>
            </tr>
        </tfoot>
    </table>
    <div id="tot-discount" style="text-align: right; font-size: 14px; padding-bottom: 8px; color: #dddddd;"></div>
    <div id="margin" style="text-align: right; font-size: 14px; padding-bottom: 8px; color: #dddddd;"></div>
    <div id="warning" style="color: #f06c20; font-size: 14px; font-weight: bold; text-align: center;"></div>
    <div id="debug" style="text-align: left; font-size: 11px; padding-bottom: 8px; color: #ffff00;"></div>
    </div>
</div>

<script language="javascript" type="text/javascript">
    var skus = {
        "Agency Pro": {
            basePrice: 750,
            vi: 300000,
            kw: 1500,
            em: 0
        },
        "Agency Complete": {
            basePrice: 1500,
            vi: 1000000,
            kw: 5000,
            em: 0
        },        
        "Express": {
            basePrice: 300,
            vi: 10000,
            kw: 50,
            em: 2500
        },
        "Team": {
            basePrice: 600,
            vi: 250000,
            kw: 500,
            em: 0
        },
        "Premium": {
            basePrice: 1500,
            vi: 750000,
            kw: 3000,
            em: 0
        }
    }


    var costvi = .00076,
        costKW = .07919,
        costEM = .003,
        thresholdviAddOn = 100000,
        costviAddOn = 100,
        thresholdKWAddOn = 500,
        costKWAddOn = 100,
        thresholdEMAddOn = 5000,
        costEMAddOn = 0;

    $(function () {
        $("#vi-discount").slider({
            min: 0,
            max: 100,
            change: function (event, ui) {
                calculate();
            },
            slide: function (event, ui) {
                $("#vi-discount-val").text(ui.value + "%");
            }
        });

        $("#kw-discount").slider({
            min: 0,
            max: 100,
            change: function (event, ui) {
                calculate();
            },
            slide: function (event, ui) {
                $("#kw-discount-val").text(ui.value + "%");
            }
        });

        $("#em-discount").slider({
            min: 0,
            max: 100,
            change: function (event, ui) {
                calculate();
            },
            slide: function (event, ui) {
                $("#em-discount-val").text(ui.value + "%");
            }
        });

        $("#discount").slider({
            min: 0,
            max: 100,
            change: function (event, ui) {
                calculate();
            },
            slide: function (event, ui) {
                var disc = ui.value;
                $("#discount-val").text(disc + "%");
            }
        });
        resetDefaults();
    });

    function calculate() {
        var vidisc = $("#vi-discount").slider("value") / 100;
        var kwdisc = $("#kw-discount").slider("value") / 100;
        var emdisc = $("#em-discount").slider("value") / 100;
        var disc = $("#discount").slider("value") / 100;
        var sku = $("#sku").val();
        var totRetail = skus[sku].basePrice;
        var totCharge = skus[sku].basePrice - (skus[sku].basePrice * disc);

        // necessary to account for selling a SKU with reduced capacity (like Pro with no email)
        var baseviCost = skus[sku].vi * costvi;
        var baseKWCost = skus[sku].kw * costKW;
        var baseEMCost = skus[sku].em * costEM;

        if ($("#pageviews").val() < skus[sku].vi) {
            baseviCost = $("#pageviews").val() * costvi;
        }

        if ($("#keywords").val() < skus[sku].kw) {
            baseKWCost = $("#keywords").val() * costKW;
        }

        if ($("#emails").val() < skus[sku].em) {
            baseEMCost = $("#emails").val() * costEM;
        }

        //var totCost = (skus[sku].vi * costvi) + (skus[sku].kw * costKW) + (skus[sku].em * costEM);
        var totCost = (baseviCost) + (baseKWCost) + (baseEMCost);

        // Express doesn"t support add-ons, disable controls
        if (sku == "Express") {
            $("#pageviews").attr("disabled", "disabled");
            $("#vi-discount").slider("option", "disabled", true);
            $("#keywords").attr("disabled", "disabled");
            $("#kw-discount").slider("option", "disabled", true);
            $("#emails").attr("disabled", "disabled");
            $("#em-discount").slider("option", "disabled", true);
        }
        else {
            $("#pageviews").removeAttr("disabled");
            $("#vi-discount").slider("option", "disabled", false);
            $("#keywords").removeAttr("disabled");
            $("#kw-discount").slider("option", "disabled", false);
            $("#emails").removeAttr("disabled");
            $("#em-discount").slider("option", "disabled", false);
        }

        var viOver = $("#pageviews").val() - skus[sku].vi;
        if (viOver > 0) {
            var addOns = Math.floor(viOver / thresholdviAddOn);
            if (viOver % thresholdviAddOn > 0) {
                addOns++;
            }
            totCost += addOns * thresholdviAddOn * costvi;
            totRetail += addOns * costviAddOn;
            totCharge += addOns * (costviAddOn - (costviAddOn * vidisc));
            $("#pageviews-cost").text(moneyFormat(addOns * thresholdviAddOn * costvi));
            $("#pageviews-retail").text(moneyFormat(addOns * costviAddOn));
            $("#pageviews-charge").text(moneyFormat(addOns * (costviAddOn - (costviAddOn * vidisc))));
        }
        else {
            // reset defaults
            $("#pageviews-cost").text("$0.00");
            $("#pageviews-retail").text("$0.00");
            $("#pageviews-charge").text("$0.00");
        }

        var kwOver = $("#keywords").val() - skus[sku].kw;
        if (kwOver > 0) {
            var addOns = Math.floor(kwOver / thresholdKWAddOn);
            if (kwOver % thresholdKWAddOn > 0) {
                addOns++;
            }
            totCost += addOns * thresholdKWAddOn * costKW;
            totRetail += addOns * costKWAddOn;
            totCharge += addOns * (costKWAddOn - (costKWAddOn * kwdisc));
            $("#keywords-cost").text(moneyFormat(addOns * thresholdKWAddOn * costKW));
            $("#keywords-retail").text(moneyFormat(addOns * costKWAddOn));
            $("#keywords-charge").text(moneyFormat(addOns * (costKWAddOn - (costKWAddOn * kwdisc))));
        }
        else {
            // reset defaults
            $("#keywords-cost").text("$0.00");
            $("#keywords-retail").text("$0.00");
            $("#keywords-charge").text("$0.00");
        }

        var emOver = $("#emails").val() - skus[sku].em;
        if (emOver > 0) {
            var addOns = Math.floor(emOver / thresholdEMAddOn);
            if (emOver % thresholdEMAddOn > 0) {
                addOns++;
            }
            totCost += addOns * thresholdEMAddOn * costEM;
            totRetail += addOns * costEMAddOn;
            totCharge += addOns * (costEMAddOn - (costEMAddOn * emdisc));
            $("#email-cost").text(moneyFormat(addOns * thresholdEMAddOn * costEM));
            $("#email-retail").text(moneyFormat(addOns * costEMAddOn));
            $("#email-charge").text(moneyFormat(addOns * (costEMAddOn - (costEMAddOn * emdisc))));
        }
        else {
            // reset defaults
            $("#email-cost").text("$0.00");
            $("#email-retail").text("$0.00");
            $("#email-charge").text("$0.00");
        }

        $("#baseline-cost").text(moneyFormat(baseviCost + baseKWCost + baseEMCost));
        $("#baseline-charge").text(moneyFormat(skus[sku].basePrice - (skus[sku].basePrice * disc)));
        $("#total-cost").text(moneyFormat(totCost));
        $("#total-retail").text(moneyFormat(totRetail));
        $("#total-charge").text(moneyFormat(totCharge));

        $("#tot-discount").text("Total discount: " + ((totRetail - totCharge) / totRetail * 100).toFixed(2) + "%");
        $("#margin").text("Gross Margin: " + ((totCharge - totCost) / totCharge * 100).toFixed(2) + "%");

        if ((totCharge - totCost) / totCharge < .75) {
            $("#warning").text("Margin too low - talk to Woody, Rob, or Chris before closing");
            $("#warning").css("border", "1px solid #f06c20");
        }
        else {
            $("#warning").text('');
            $("#warning").css("border", "none");
        }
    }

    function moneyFormat(num) {
        return "$" + num.toFixed(2);
    }

    function resetDefaults() {
        $("#vi-discount").slider("value", 0);
        $("#vi-discount-val").text("0%");
        $("#kw-discount").slider("value", 0);
        $("#kw-discount-val").text("0%");
        $("#em-discount").slider("value", 0);
        $("#em-discount-val").text("0%");
        $("#discount").slider("value", 0);
        $("#discount-val").text("0%");

        $("#pageviews-cost").text("$0.00");
        $("#pageviews-retail").text("$0.00");
        $("#pageviews-charge").text("$0.00");

        $("#keywords-cost").text("$0.00");
        $("#keywords-retail").text("$0.00");
        $("#keywords-charge").text("$0.00");

        $("#email-cost").text("$0.00");
        $("#email-retail").text("$0.00");
        $("#email-charge").text("$0.00");

        var sku = $("#sku").val();

        $("#pageviews").val(skus[sku].vi);
        $("#keywords").val(skus[sku].kw);
        $("#emails").val(skus[sku].em);
        $("#baseline-cost").text(moneyFormat((skus[sku].vi * costvi) + (skus[sku].kw * costKW) + (skus[sku].em * costEM)));
        $("#baseline-retail").text(moneyFormat(skus[sku].basePrice));
        $("#baseline-charge").text(moneyFormat(skus[sku].basePrice));
        $("#total-cost").text(moneyFormat((skus[sku].vi * costvi) + (skus[sku].kw * costKW) + (skus[sku].em * costEM)));
        $("#total-retail").text(moneyFormat(skus[sku].basePrice));
        $("#total-charge").text(moneyFormat(skus[sku].basePrice));

        calculate();
    }

</script>